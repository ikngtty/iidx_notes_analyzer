# IIDX Notes Analyzer

弐寺の譜面を分析するためのツールです。\
[TexTage](https://textage.cc)から譜面データをスクレイピングしています。

## 合法性

以下を確認し、法的に問題が無いことを確認しています。\
問題があればissueからの報告をお願いします。

- 利用規約
    - 読んだ結果、問題なさそう
- robots.txt
    - 見つからないのでなさそう
- その他一般的な規範
    - 連続アクセス時は間隔を1秒以上空けるつもり
        - このツール自体をありえない速度で何度も起動したりしないようお願いします

## 起動の仕方

まだインストーラー等に固めるつもりはないので、開発者用の実行方法しかありません。\
開発環境の作成を含む感じになってくるので、少し込み入った手順になります。

※ Macでのみ起動確認をしています。Windowsではターミナルに入力するコマンド等が微妙に異なってくると思いますが、その辺は自身で解決をお願いします。

### 1. Pythonをインストール

### 2. 仮想環境の作成

このツールは他者が作ったライブラリを利用します。\
この際、他のプログラムも使用するようなグローバルな領域にライブラリをダウンロードして使用すると、他のプログラムが勝手にライブラリをアップデートして、その結果こちらのプログラムがバグる、というような事態が発生します。\
そのため、ライブラリのダウンロード先をローカルな場所に設定すると共に、本ツール使用時はそこのライブラリしか使用しないような設定を行います。\
これが仮想化です。\
めんどかったらやらなくてもいいです。

```console
# 本ツールのあるフォルダ上で実行してください。
# 成功すると、本ツールのあるフォルダの直下に`.venv`フォルダが作成されます。
python -m venv .venv
```

以降、pythonを呼び出す時は`.venv/bin/python`の方を呼び出す必要があります。\
これをいちいち打ち込むのはめんどくさいですが、以下のアクティベーションを行うことで、`.venv/bin`フォルダにパスが通るようになり、単に`python`と打ち込んでもこちらのpythonを呼び出すことができるようになります。

```console
# 本ツールのあるフォルダ上で実行してください。
# シェルやOSの種類によって呼ぶプログラムが変わってきます。詳しくは調べてください。
source .venv/bin/activate
```

アクティベーションの効果はターミナルを閉じた際に自動で終了すると思いますが、手動で終了したい場合は以下のアクティベーション解除を行う必要があります。

```console
# `.venv/bin`にパスが通っているため、これだけで呼べます。
deactivate
```

### 3. ライブラリのダウンロード

```console
# 本ツールのあるフォルダ上で実行してください。
python -m pip install -r requirements.txt
```

### 4. 本ツールが使用するブラウザエンジンのインストール

```console
playwright install chromium
```

仮想環境を用意しようと関係なく、ブラウザエンジンはグローバルにインストールされます。残念。

### 5. `scrape_song_list`を実行

ようやくプログラムの実行です。\
まずは`scrape_song_list`を実行することで、TexTageから楽曲データをスクレイピングしてきます。

```console
# 本ツールのあるフォルダ上で実行してください。
python -m iidx_notes_analyzer scrape_song_list
```

取ってきたデータは本ツールがあるフォルダ直下の`data`フォルダ下に保存されます。\
サイトに何度もアクセスするのも迷惑になるので、一度データを保存し、後は保存後のデータをわちゃわちゃ解析しまくる方針としています。

### 6. `scrape_score`を実行

次に`scrape_score`を実行することで、曲毎に譜面データをスクレイピングしてきます。

```console
# 本ツールのあるフォルダ上で実行してください。
python -m iidx_notes_analyzer scrape_score
```

とりあえずAA(SPA)の譜面データだけ保存するところまで作りました。\
次はACの全曲の譜面データを保存できるようにするつもりです。

### 7. `analyze`を実行

```console
# 本ツールのあるフォルダ上で実行してください。
python -m iidx_notes_analyzer analyze
```

保存した譜面データを分析し、結果を表示します。

とりあえず、AA(SPA)の譜面について、全ての同時押しパターンの個数を表示するところまで作りました。

### 8. 結果の確認

TexTageには同時押しの個数を数える機能があるので、それでいくつかの同時押しパターンの個数を調べ、分析結果と一致することを確認できます。

## 実行結果

```
 |______:38
 _|_____:101
 __|____:91
 ___|___:136
 ____|__:126
 _____|_:93
 ______|:80
 ||_____:3
 |_|____:19
 |__|___:11
 |___|__:10
 |____|_:17
 |_____|:6
 _|_|___:6
 _|__|__:19
 _|___|_:19
 _|____|:14
 __||___:2
 __|_|__:16
 __|__|_:19
 __|___|:26
 ___|_|_:11
 ___|__|:16
 ____||_:2
 ____|_|:24
 _____||:4
 |||____:13
 ||_|___:3
 ||__|__:13
 ||___|_:3
 ||____|:3
 |_||___:21
 |_|_|__:5
 |_|__|_:13
 |_|___|:7
 |__||__:1
 |__|_|_:21
 |__|__|:5
 |___|_|:2
 _||_|__:1
 _|_|_|_:5
 _|__||_:2
 _|__|_|:1
 _|___||:2
 __|||__:2
 __||__|:2
 __|_||_:3
 __|_|_|:8
 __|__||:6
 ||||___:2
 |||_|__:3
 |||___|:3
 ||_|_|_:4
 ||__||_:6
 ||__|_|:4
 |_||_|_:2
 |_||__|:1
 |_|_||_:2
 |_|_|_|:2
 |__|||_:1
 |___|||:1
 _|_|||_:1
 __||||_:2
 __|_|||:3
 |||_|_|:1
 |_|||_|:2
 |_|_|||:1
S|______:2
S||_____:3
S|_|____:1
S__|___|:1
S____|_|:1
S||__|__:6
S||____|:1
S|_|___|:2
S|__|__|:1
S||__||_:4
S|_|_|_|:1
```
